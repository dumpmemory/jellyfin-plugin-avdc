<!DOCTYPE html>
<html lang="en">
<head>
    <title>AVDC</title>
</head>
<body>
<div class="page type-interior pluginConfigurationPage musicBrainzConfigPage"
     data-require="emby-input,emby-button,emby-checkbox"
     data-role="page">
    <div data-role="content">
        <div class="content-primary">
            <form class="avdcConfigForm">
                <div class="inputContainer">
                    <input id="server" is="emby-input" label="Server" required type="text"/>
                    <div class="fieldDescription">URL of Backend AVDC Server.</div>
                </div>
                <div class="inputContainer">
                    <input id="token" is="emby-input" label="Token" type="text"/>
                    <div class="fieldDescription">Token for AVDC Server.</div>
                </div>
                <div>
                    <button class="raised button-submit block" is="emby-button" type="submit"><span>Save</span></button>
                </div>
            </form>
        </div>
    </div>
    <script type="text/javascript">
        var AVDCPluginConfig = {
            uniquePluginId: "001c811c-145d-4b43-94bf-f78e8d7b6afd"
        };

        document.querySelector('.musicBrainzConfigPage')
            .addEventListener('pageshow', function () {
                Dashboard.showLoadingMsg();
                ApiClient.getPluginConfiguration(AVDCPluginConfig.uniquePluginId).then(function (config) {
                    var server = document.querySelector('#server');
                    server.value = config.Server;
                    server.dispatchEvent(new Event('change', {
                        bubbles: true,
                        cancelable: false
                    }));

                    var token = document.querySelector('#token');
                    token.value = config.Token;
                    token.dispatchEvent(new Event('change', {
                        bubbles: true,
                        cancelable: false
                    }));

                    Dashboard.hideLoadingMsg();
                });
            });

        document.querySelector('.avdcConfigForm')
            .addEventListener('submit', function (e) {
                Dashboard.showLoadingMsg();

                ApiClient.getPluginConfiguration(AVDCPluginConfig.uniquePluginId).then(function (config) {
                    config.Server = document.querySelector('#server').value;
                    config.Token = document.querySelector('#token').value;

                    ApiClient.updatePluginConfiguration(AVDCPluginConfig.uniquePluginId, config).then(Dashboard.processPluginConfigurationUpdateResult);
                });

                e.preventDefault();
                return false;
            });
    </script>
</div>
</body>
</html>